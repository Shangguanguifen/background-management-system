{"version":3,"sources":["service/productService.js","page/product/productList/categorySelect.jsx","page/product/productList/imgUpload.jsx","util/richEditor/index.jsx","page/product/productList/save.jsx"],"names":["_commonUtil","CommonUtil","Product","listParam","url","data","pageNum","listType","searchType","searchKeyword","request","type","productId","productInfo","categoryId","product","category","_product","Option","CategorySelect","props","useState","firstCategoryList","setFirstCategoryList","firstCategoryId","setFirstCategoryId","secondCategoryList","setSecondCategoryList","secondCategoryId","setSecondCategoryId","loadFirstCategory","getCategoryList","then","res","forEach","item","label","name","value","id","catch","err","errorTips","handleFirstCategoryChange","console","log","onPropsCategoryChange","useCallback","categoryChangable","onCategoryChange","useEffect","categoryIdArr","style","width","marginRight","onChange","onDropdownVisibleChange","placeholder","map","length","ImgUpload","fileList","setFileList","previewImage","setPreviewImage","previewTitle","setPreviewTitle","previewVisible","setPreviewVisible","images","uri","imagesArr","split","index","file","uid","status","urlHost","loadInitFileList","getBase64","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","handlePreview","a","preview","originFileObj","substring","lastIndexOf","uploadButton","PlusOutlined","marginTop","action","method","enctype","onPreview","onGetImageDesc","visible","title","footer","onCancel","alt","src","RichEditor","textarea","useRef","element","detailValue","editor","Simditor","$","upload","fileKey","pasteImage","setValue","on","onEditorValueChange","getValue","loadEditor","current","detail","ref","layout","labelCol","span","wrapperCol","tailLayout","offset","richEditorLayout","ProductSave","detailDate","setDetailDate","setCategoryId","subImages","setSubImages","setDetail","match","params","setId","init","setInit","addForm","loadProduct","getProduct","setFieldsValue","subtitle","price","stock","onFinish","values","addProduct","successTips","history","push","onFinishFailed","errorInfo","scrollToFirstError","Item","rules","required","message","parentCategoryId","noStyle","className","imageList","reg","RegExp","image","initType","join","imageHost","htmlType"],"mappings":"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","file":"static/js/16.eb94608e.chunk.js","sourcesContent":["import CommonUtil from 'util/common';\r\n\r\nlet _commonUtil = new CommonUtil();\r\n\r\nclass Product{\r\n  // 获取商品信息列表\r\n  getProductList(listParam) {\r\n    let url = '',\r\n      data = {};\r\n    data.pageNum = listParam.pageNum;\r\n    if(listParam.listType === 'list') {\r\n      url = '/manage/product/list.do';\r\n    } else if(listParam.listType === 'search') {\r\n      url = '/manage/product/search.do';\r\n      data[listParam.searchType] = listParam.searchKeyword\r\n    }\r\n    return _commonUtil.request({\r\n      type: 'post',\r\n      url: url,\r\n      data: data\r\n    })\r\n  }\r\n\r\n  // 获取商品详情\r\n  getProduct(productId) {\r\n    return _commonUtil.request({\r\n      type: 'post',\r\n      url: '/manage/product/detail.do',\r\n      data: {\r\n        productId: productId || 0\r\n      }\r\n    })\r\n  }\r\n\r\n  // 变更商品销售状态\r\n  setProductStatus(productInfo) {\r\n    return _commonUtil.request({\r\n      type: 'post',\r\n      url: '/manage/product/set_sale_status.do',\r\n      data: productInfo\r\n    })\r\n  }\r\n\r\n  // 获取品类列表\r\n  getCategoryList(categoryId) {\r\n    return _commonUtil.request({\r\n      type: 'post',\r\n      url: '/manage/category/get_category.do',\r\n      data: {\r\n        categoryId: categoryId || 0\r\n      }\r\n    })\r\n  }\r\n\r\n  // 新增商品\r\n  addProduct(product) {\r\n    return _commonUtil.request({\r\n      type: 'post',\r\n      url: '/manage/product/save.do',\r\n      data: product\r\n    })\r\n  }\r\n  // 修改品类名称\r\n  updateCategoryName(category) {\r\n    return _commonUtil.request({\r\n      type: 'post',\r\n      url: '/manage/category/set_category_name.do',\r\n      data: category\r\n    })\r\n  }\r\n\r\n  // 新增商品品类\r\n  addCategory(category){\r\n    return _commonUtil.request({\r\n      type    : 'post',\r\n      url     : '/manage/category/add_category.do',\r\n      data    : category\r\n  });\r\n}\r\n\r\n}\r\nexport default Product;","/*\n * @Author: Guifen Shangguan \n * @Date: 2021-04-08 20:04:47 \n * @Last Modified by: Guifen Shangguan\n * @Last Modified time: 2021-04-08 20:06:18\n */\nimport { useState, useCallback, useEffect } from 'react'\nimport { Select } from 'antd';\n\nimport Product from 'service/productService';\nimport CommonUtil from 'util/common';\n\nlet _commonUtil = new CommonUtil();\nconst _product = new Product();\n\nconst { Option } = Select;\n\nconst CategorySelect = (props) => {\n  const [firstCategoryList, setFirstCategoryList] = useState([]);\n  const [firstCategoryId, setFirstCategoryId] = useState(0);\n  const [secondCategoryList, setSecondCategoryList] = useState([]);\n  const [secondCategoryId, setSecondCategoryId] = useState(0);\n  \n\n  // 加载编辑页面初始数据\n  const loadInitValue = (categoryIdArr) => {    \n    setFirstCategoryId(categoryIdArr[0]);\n    loadFirstCategory();\n\n    if(categoryIdArr[1] !== 0) {\n      // 有两级品类\n      setSecondCategoryId(categoryIdArr[1]);\n      handleFirstCategoryChange(categoryIdArr[0])\n    }\n    \n  }\n\n\n  // 获取一级品类\n  const loadFirstCategory = () => {\n    return  _product.getCategoryList().then(res =>{\n      res.forEach(item => {\n        res.label = item.name;\n        res.value = item.id;\n      })\n      setFirstCategoryList(res);\n    }).catch(err => {\n      _commonUtil.errorTips(err);\n    })\n  }\n\n  const handleGetCategoryList = () => {\n    loadFirstCategory();\n  };\n\n  // 获取二级品类\n  const handleFirstCategoryChange = value => {\n    console.log(value, 'value')\n    \n    setFirstCategoryId(value);\n\n    _product.getCategoryList(value).then(res => {\n      res.forEach(item => {\n        res.label = item.name;\n        res.value = item.id;\n      })\n      setSecondCategoryList(res);\n    }).catch(err => {\n      _commonUtil.errorTips(err);\n    })\n  };\n\n  const handleSecondCategoryChange = value => {\n    setSecondCategoryId(value);\n  };\n\n  // 将品类Id传给父组件\n  const onPropsCategoryChange = useCallback(() => {\n    let categoryChangable = typeof props.onCategoryChange === 'function';\n    if(secondCategoryId) {\n      categoryChangable && props.onCategoryChange(secondCategoryId, firstCategoryId);\n    } else {\n      // 没有选择二级品类\n      categoryChangable && props.onCategoryChange(firstCategoryId, 0);\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [firstCategoryId, secondCategoryId])\n\n  useEffect(() => {\n    onPropsCategoryChange();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [onPropsCategoryChange])\n\n  useEffect(() => {\n    if(props.categoryId[0]) {\n      loadInitValue(props.categoryId)\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.categoryId])\n  console.log(typeof firstCategoryId, 'typeof firstCategoryId')\n  return (\n    <>\n      <Select\n        style={{ width: 186, marginRight: 14 }}\n        onChange={handleFirstCategoryChange}\n        value={firstCategoryId}\n        onDropdownVisibleChange={handleGetCategoryList}\n        placeholder=\"请选择一级品类\">\n          {firstCategoryList.map(category => {\n            return (\n                <Option value={category.id} key={category.id}>{category.name}</Option>\n              )\n          })}\n      </Select>\n      {secondCategoryList.length > 0 ? \n        <Select\n          style={{ width: 186 }}\n          value={secondCategoryId}\n          onChange={handleSecondCategoryChange}\n          placeholder=\"请选择二级品类\">\n            {secondCategoryList.map(category => (\n              <Option value={category.name} key={category.id}>{category.name}</Option>\n            ))}\n      </Select> : null}\n    </>\n  );\n};\n\nexport default CategorySelect;\n\n","/*\n * @Author: Guifen Shangguan \n * @Date: 2021-04-04 20:01:05 \n * @Last Modified by: Guifen Shangguan\n * @Last Modified time: 2021-04-08 20:06:55\n */\nimport { Upload, Modal } from 'antd';\nimport { PlusOutlined } from '@ant-design/icons';\nimport { useEffect, useState } from 'react';\n\nimport CommonUtil from 'util/common';\n\nlet _commonUtil = new CommonUtil();\n\n\n\nfunction ImgUpload(props) {\n  const [fileList, setFileList] = useState([]);\n  const [previewImage, setPreviewImage] = useState('');\n  const [previewTitle, setPreviewTitle] = useState('');\n  const [previewVisible, setPreviewVisible] = useState(false);\n\n  const loadInitFileList = (images) => {\n    console.log(images)\n    if(images.uri) {\n      // console.log('kk')\n      let imagesUri = images.uri ? images.uri : ''\n      let imagesArr = imagesUri.split(',').map((uri, index) => {\n        let file = {};\n        file.uid = uri;\n        file.name = 'image.png';\n        file.status = 'done';\n        file.url = props.images.urlHost + uri;\n        return file;\n      })\n      setFileList(imagesArr)\n    }\n    \n  }\n\n  useEffect(() => {\n    loadInitFileList(props.images)\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.images])\n\n  const getBase64 = (file) => {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(file);\n      reader.onload = () => resolve(reader.result);\n      reader.onerror = error => reject(error);\n    });\n  }\n  \n  const handleCancel = () => {\n    setPreviewVisible(false);\n  };\n  const handlePreview = async file => {\n    if (!file.url && !file.preview) {\n      file.preview = await getBase64(file.originFileObj);\n    }\n    setPreviewImage(file.url || file.preview);\n    setPreviewVisible(true);\n    setPreviewTitle(file.name || file.url.substring(file.url.lastIndexOf('/') + 1))\n  };\n\n  const handleChange = ({fileList}) => {\n    setFileList(fileList);\n    if(fileList.length > 0 && fileList[0].status === 'error') {\n      _commonUtil.errorTips('上传失败');\n    } else {\n      props.onGetImageDesc(fileList, 'init');\n    }\n  };\n\n  const uploadButton = (\n    <div>\n      <PlusOutlined />\n      <div style={{ marginTop: 8 }}>Upload</div>\n    </div>\n  );\n\n  // http://admintest.happymmall.com\n  return (\n    <div>\n      <Upload\n          action=\"/manage/product/upload.do\"\n          method=\"post\"\n          enctype=\"multipart/form-data\"\n          name=\"upload_file\"\n          listType=\"picture-card\"\n          fileList={fileList}\n          onPreview={handlePreview}\n          onChange={handleChange}\n        >\n          {fileList.length >= 100 ? null : uploadButton}\n        </Upload>\n        <Modal\n          visible={previewVisible}\n          title={previewTitle}\n          footer={null}\n          onCancel={handleCancel}\n        >\n          <img alt={previewTitle} style={{ width: '100%' }} src={previewImage} />\n        </Modal>\n    </div>\n  );\n}\n\nexport default ImgUpload;\n","/*\n * @Author: Guifen Shangguan \n * @Date: 2021-04-04 21:04:45 \n * @Last Modified by: Guifen Shangguan\n * @Last Modified time: 2021-04-06 19:00:50\n */\nimport { useRef, useEffect } from 'react';\nimport Simditor from 'simditor';\nimport 'simditor/styles/simditor.scss';\n\n// 通用的富文本编辑器，依赖jquery\nfunction RichEditor(props) {\n  const textarea = useRef(null);\n\n  const loadEditor = (element, detailValue) => {\n    const editor = new Simditor({\n      // eslint-disable-next-line no-undef\n      textarea: $(element),\n      placeholder: props.placeholder || '请输入内容',\n      upload: {\n        url: '/manage/product/richtext_img_upload.do',\n        fileKey: 'upload_file'\n      },\n      pasteImage: true\n    });\n\n    // 获取初始数据\n    if(detailValue) {\n      editor.setValue(detailValue);\n    }\n\n    editor.on('valuechanged', () => {\n      props.onEditorValueChange(editor.getValue())\n    })\n    return editor;\n  }\n  \n  useEffect(() => {\n    loadEditor(textarea.current, props.detail);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [textarea.current, props.detail])\n\n  return (\n    <div>\n      <textarea ref={textarea}></textarea>\n    </div>\n  );\n}\n\nexport default RichEditor;\n","import { Form, Input, Button, InputNumber } from 'antd';\n\nimport CategorySelect from './categorySelect';\nimport ImgUpload from './imgUpload';\nimport RichEditor from 'util/richEditor';\nimport { useEffect, useState, useCallback, useRef } from 'react';\n\nimport Product from 'service/productService';\nimport CommonUtil from 'util/common';\n\nlet _commonUtil = new CommonUtil();\nconst _product = new Product();\n\n\n\n// 表单样式\nconst layout = {\n  labelCol: {\n    span: 4,\n  },\n  wrapperCol: {\n    span: 8,\n  },\n};\nconst tailLayout = {\n  wrapperCol: {\n    offset: 4,\n    span: 8,\n  },\n};\nconst richEditorLayout = {\n  wrapperCol: {\n    span: 16,\n  },\n};\n\nconst ProductSave = (props) => {\n  const [detailDate, setDetailDate] = useState({})\n  const [categoryId, setCategoryId] = useState(0);\n  const [subImages, setSubImages] = useState('');\n  const [detail, setDetail] = useState({});\n  const [id, setId] = useState(props.match.params.id);\n  const [init, setInit] = useState('');\n  const addForm = useRef(null);\n\n  const onFinish = (values) => {\n    const product = values;\n    if(id) {\n      product.id = id;\n    }\n    product.categoryId = categoryId;\n    product.subImages = subImages;\n    product.detail = detail;\n    product.status = 1;  //商品提交之后默认状态1为在售\n\n    _product.addProduct(product).then(res => {\n      _commonUtil.successTips(res);\n      props.history.push('/product/productList')\n    }).catch(err => {\n      _commonUtil.successTips(err);\n    })\n  };\n\n  const onFinishFailed = (errorInfo) => {\n    _commonUtil.errorTips(errorInfo);\n    console.log('Failed:', errorInfo);\n  };\n\n  // 获取品类信息\n  const onCategoryChange = (categoryId, parentCategoryId) => {\n    setCategoryId(categoryId);\n  }\n\n  // 获取图片信息response\n  const onGetImageDesc = (imageList, init) => {\n    const reg = new RegExp(/(\\.[a-z]*)/g);\n    let subImages = imageList.map(image => {\n      const initType = (image.uid).match(reg)\n      const type = (image.name).match(reg)[0];\n      const result = initType ? image.uid : image.uid + type;\n      return result;\n    }).join(',');\n    setSubImages(subImages);\n    setInit(init)\n  }\n\n  // 获取富文本信息\n  const onEditorValueChange = (value) => {\n    setDetail(value);\n  }\n\n\n  // 加载商品详情\n  const loadProduct = useCallback((id) => {\n    if(id) {\n      _product.getProduct(id).then(res => {\n        addForm.current.setFieldsValue({\n          name: res.name,\n          subtitle: res.subtitle,\n          price: res.price,\n          stock: res.stock,\n        })\n        setDetailDate(res)\n      }).catch(err => {\n        _commonUtil.errorTips(err);\n      })\n    }\n  }, [])\n\n  useEffect(() => {\n    setId(props.match.params.id)\n    loadProduct(id)\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n\n  return (\n    <Form\n      {...layout}\n      // name=\"basic\"\n      ref={addForm}\n      onFinish={onFinish}\n      onFinishFailed={onFinishFailed}\n      scrollToFirstError={true}\n    >\n      <Form.Item\n        label=\"商品名称\"\n        name=\"name\"\n        \n        rules={[\n          {\n            required: true,\n            message: '商品名称不能为空!',\n          },\n        ]}\n      >\n        <Input/>\n      </Form.Item>\n\n      <Form.Item\n        label=\"商品描述\"\n        name=\"subtitle\"\n        rules={[\n          {\n            required: true,\n            message: '商品描述不能为空!',\n          },\n        ]}\n      >\n        <Input />\n      </Form.Item>\n\n      {/* 商品分类 */}\n      <Form.Item\n        label=\"所属分类\"\n        rules={[\n          {\n            required: true,\n            message: '请选择商品品类!',\n          },\n        ]}>\n        <CategorySelect\n          onCategoryChange={onCategoryChange}\n          categoryId={[detailDate.categoryId, detailDate.parentCategoryId]}/>\n      </Form.Item>\n\n      <Form.Item label=\"商品价格\">\n        <Form.Item name=\"price\" noStyle rules={[\n          {\n            required: true,\n            message: '请输入商品价格!',\n          },\n        ]}>\n          <InputNumber />\n        </Form.Item>\n        <span className=\"ant-form-text\"> 元</span>\n      </Form.Item>\n      <Form.Item label=\"商品库存\">\n        <Form.Item name=\"stock\" noStyle  rules={[\n          {\n            required: true,\n            message: '请输入库存数量!',\n          },\n        ]}>\n          <InputNumber />\n        </Form.Item>\n        <span className=\"ant-form-text\"> 件</span>\n      </Form.Item>\n\n      {/* 上传图片 */}\n      <Form.Item label=\"商品图片\">\n        <ImgUpload\n          onGetImageDesc={onGetImageDesc}\n          images={init || subImages ? subImages : {\n            uri: detailDate.subImages,\n            urlHost: detailDate.imageHost}}\n          />\n      </Form.Item>\n\n      {/* 富文本编辑框 */}\n      <Form.Item label=\"商品详情\" {...richEditorLayout}>\n        <RichEditor onEditorValueChange={onEditorValueChange} detail={detailDate.detail}></RichEditor>\n      </Form.Item>\n\n      <Form.Item {...tailLayout}>\n        <Button type=\"primary\" htmlType=\"submit\">\n          Submit\n        </Button>\n      </Form.Item>\n    </Form>\n  );\n};\n\nexport default ProductSave;"],"sourceRoot":""}