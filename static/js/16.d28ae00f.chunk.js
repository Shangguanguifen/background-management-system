(this.webpackJsonpa=this.webpackJsonpa||[]).push([[16],{444:function(e,t,a){"use strict";var n=a(60),r=a(61),c=new(a(57).a),u=function(){function e(){Object(n.a)(this,e)}return Object(r.a)(e,[{key:"getProductList",value:function(e){var t="",a={};return a.pageNum=e.pageNum,"list"===e.listType?t="/manage/product/list.do":"search"===e.listType&&(t="/manage/product/search.do",a[e.searchType]=e.searchKeyword),c.request({type:"post",url:t,data:a})}},{key:"getProduct",value:function(e){return c.request({type:"post",url:"/manage/product/detail.do",data:{productId:e||0}})}},{key:"setProductStatus",value:function(e){return c.request({type:"post",url:"/manage/product/set_sale_status.do",data:e})}},{key:"getCategoryList",value:function(e){return c.request({type:"post",url:"/manage/category/get_category.do",data:{categoryId:e||0}})}},{key:"addProduct",value:function(e){return c.request({type:"post",url:"/manage/product/save.do",data:e})}},{key:"updateCategoryName",value:function(e){return c.request({type:"post",url:"/manage/category/set_category_name.do",data:e})}},{key:"addCategory",value:function(e){return c.request({type:"post",url:"/manage/category/add_category.do",data:e})}}]),e}();t.a=u},654:function(e,t,a){"use strict";a.r(t);a(79);var n=a(58),r=a.n(n),c=a(38),u=(a(496),a(506)),s=a.n(u),o=(a(189),a(75)),i=a.n(o),l=(a(131),a(105)),d=a.n(l),j=a(59),b=(a(458),a(448)),p=a.n(b),f=a(0),g=a(444),m=a(57),O=a(4),h=new m.a,y=new g.a,v=p.a.Option,x=function(e){var t=Object(f.useState)([]),a=Object(j.a)(t,2),n=a[0],r=a[1],c=Object(f.useState)(0),u=Object(j.a)(c,2),s=u[0],o=u[1],i=Object(f.useState)([]),l=Object(j.a)(i,2),d=l[0],b=l[1],g=Object(f.useState)(0),m=Object(j.a)(g,2),x=m[0],C=m[1],w=function(){return y.getCategoryList().then((function(e){e.forEach((function(t){e.label=t.name,e.value=t.id})),r(e)})).catch((function(e){h.errorTips(e)}))},I=function(e){console.log(e,"value"),o(e),y.getCategoryList(e).then((function(e){e.forEach((function(t){e.label=t.name,e.value=t.id})),b(e)})).catch((function(e){h.errorTips(e)}))},S=Object(f.useCallback)((function(){var t="function"===typeof e.onCategoryChange;x?t&&e.onCategoryChange(x,s):t&&e.onCategoryChange(s,0)}),[s,x]);return Object(f.useEffect)((function(){S()}),[S]),Object(f.useEffect)((function(){var t;e.categoryId[0]&&(t=e.categoryId,o(t[0]),w(),0!==t[1]&&(C(t[1]),I(t[0])))}),[e.categoryId]),console.log(typeof s,"typeof firstCategoryId"),Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(p.a,{style:{width:186,marginRight:14},onChange:I,value:s,onDropdownVisibleChange:function(){w()},placeholder:"\u8bf7\u9009\u62e9\u4e00\u7ea7\u54c1\u7c7b",children:n.map((function(e){return Object(O.jsx)(v,{value:e.id,children:e.name},e.id)}))}),d.length>0?Object(O.jsx)(p.a,{style:{width:186},value:x,onChange:function(e){C(e)},placeholder:"\u8bf7\u9009\u62e9\u4e8c\u7ea7\u54c1\u7c7b",children:d.map((function(e){return Object(O.jsx)(v,{value:e.name,children:e.name},e.id)}))}):null]})},C=(a(589),a(618)),w=a.n(C),I=(a(591),a(595)),S=a.n(I),k=a(497),T=a.n(k),q=a(498),E=a(644),_=new m.a;var F=function(e){var t=Object(f.useState)([]),a=Object(j.a)(t,2),n=a[0],r=a[1],c=Object(f.useState)(""),u=Object(j.a)(c,2),s=u[0],o=u[1],i=Object(f.useState)(""),l=Object(j.a)(i,2),d=l[0],b=l[1],p=Object(f.useState)(!1),g=Object(j.a)(p,2),m=g[0],h=g[1];Object(f.useEffect)((function(){!function(t){if(console.log(t),t.uri){var a=(t.uri?t.uri:"").split(",").map((function(t,a){var n={};return n.uid=t,n.name="image.png",n.status="done",n.url=e.images.urlHost+t,n}));r(a)}}(e.images)}),[e.images]);var y=function(e){return new Promise((function(t,a){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){return t(n.result)},n.onerror=function(e){return a(e)}}))},v=function(){var e=Object(q.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.url||t.preview){e.next=4;break}return e.next=3,y(t.originFileObj);case 3:t.preview=e.sent;case 4:o(t.url||t.preview),h(!0),b(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=Object(O.jsxs)("div",{children:[Object(O.jsx)(E.a,{}),Object(O.jsx)("div",{style:{marginTop:8},children:"Upload"})]});return Object(O.jsxs)("div",{children:[Object(O.jsx)(S.a,{action:"/manage/product/upload.do",method:"post",enctype:"multipart/form-data",name:"upload_file",listType:"picture-card",fileList:n,onPreview:v,onChange:function(t){var a=t.fileList;r(a),a.length>0&&"error"===a[0].status?_.errorTips("\u4e0a\u4f20\u5931\u8d25"):e.onGetImageDesc(a,"init")},children:n.length>=100?null:x}),Object(O.jsx)(w.a,{visible:m,title:d,footer:null,onCancel:function(){h(!1)},children:Object(O.jsx)("img",{alt:d,style:{width:"100%"},src:s})})]})},L=a(623),P=a.n(L);a(626);var R=function(e){var t=Object(f.useRef)(null);return Object(f.useEffect)((function(){!function(t,a){var n=new P.a({textarea:$(t),placeholder:e.placeholder||"\u8bf7\u8f93\u5165\u5185\u5bb9",upload:{url:"/manage/product/richtext_img_upload.do",fileKey:"upload_file"},pasteImage:!0});a&&n.setValue(a),n.on("valuechanged",(function(){e.onEditorValueChange(n.getValue())}))}(t.current,e.detail)}),[t.current,e.detail]),Object(O.jsx)("div",{children:Object(O.jsx)("textarea",{ref:t})})},V=new m.a,N=new g.a,D={labelCol:{span:4},wrapperCol:{span:8}},H={wrapperCol:{offset:4,span:8}},G={wrapperCol:{span:16}};t.default=function(e){var t=Object(f.useState)({}),a=Object(j.a)(t,2),n=a[0],u=a[1],o=Object(f.useState)(0),l=Object(j.a)(o,2),b=l[0],p=l[1],g=Object(f.useState)(""),m=Object(j.a)(g,2),h=m[0],y=m[1],v=Object(f.useState)({}),C=Object(j.a)(v,2),w=C[0],I=C[1],S=Object(f.useState)(e.match.params.id),k=Object(j.a)(S,2),T=k[0],q=k[1],E=Object(f.useState)(""),_=Object(j.a)(E,2),L=_[0],P=_[1],J=Object(f.useRef)(null),K=Object(f.useCallback)((function(e){e&&N.getProduct(e).then((function(e){J.current.setFieldsValue({name:e.name,subtitle:e.subtitle,price:e.price,stock:e.stock}),u(e)})).catch((function(e){V.errorTips(e)}))}),[]);return Object(f.useEffect)((function(){q(e.match.params.id),K(T)}),[]),Object(O.jsxs)(i.a,Object(c.a)(Object(c.a)({},D),{},{ref:J,onFinish:function(t){var a=t;T&&(a.id=T),a.categoryId=b,a.subImages=h,a.detail=w,a.status=1,N.addProduct(a).then((function(t){V.successTips(t),e.history.push("/product/productList")})).catch((function(e){V.successTips(e)}))},onFinishFailed:function(e){V.errorTips(e),console.log("Failed:",e)},scrollToFirstError:!0,children:[Object(O.jsx)(i.a.Item,{label:"\u5546\u54c1\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u5546\u54c1\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a!"}],children:Object(O.jsx)(d.a,{})}),Object(O.jsx)(i.a.Item,{label:"\u5546\u54c1\u63cf\u8ff0",name:"subtitle",rules:[{required:!0,message:"\u5546\u54c1\u63cf\u8ff0\u4e0d\u80fd\u4e3a\u7a7a!"}],children:Object(O.jsx)(d.a,{})}),Object(O.jsx)(i.a.Item,{label:"\u6240\u5c5e\u5206\u7c7b",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5546\u54c1\u54c1\u7c7b!"}],children:Object(O.jsx)(x,{onCategoryChange:function(e,t){p(e)},categoryId:[n.categoryId,n.parentCategoryId]})}),Object(O.jsxs)(i.a.Item,{label:"\u5546\u54c1\u4ef7\u683c",children:[Object(O.jsx)(i.a.Item,{name:"price",noStyle:!0,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5546\u54c1\u4ef7\u683c!"}],children:Object(O.jsx)(s.a,{})}),Object(O.jsx)("span",{className:"ant-form-text",children:" \u5143"})]}),Object(O.jsxs)(i.a.Item,{label:"\u5546\u54c1\u5e93\u5b58",children:[Object(O.jsx)(i.a.Item,{name:"stock",noStyle:!0,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5e93\u5b58\u6570\u91cf!"}],children:Object(O.jsx)(s.a,{})}),Object(O.jsx)("span",{className:"ant-form-text",children:" \u4ef6"})]}),Object(O.jsx)(i.a.Item,{label:"\u5546\u54c1\u56fe\u7247",children:Object(O.jsx)(F,{onGetImageDesc:function(e,t){var a=new RegExp(/(\.[a-z]*)/g),n=e.map((function(e){var t=e.uid.match(a),n=e.name.match(a)[0];return t?e.uid:e.uid+n})).join(",");y(n),P(t)},images:L||h?h:{uri:n.subImages,urlHost:n.imageHost}})}),Object(O.jsx)(i.a.Item,Object(c.a)(Object(c.a)({label:"\u5546\u54c1\u8be6\u60c5"},G),{},{children:Object(O.jsx)(R,{onEditorValueChange:function(e){I(e)},detail:n.detail})})),Object(O.jsx)(i.a.Item,Object(c.a)(Object(c.a)({},H),{},{children:Object(O.jsx)(r.a,{type:"primary",htmlType:"submit",children:"Submit"})}))]}))}}}]);
//# sourceMappingURL=16.d28ae00f.chunk.js.map